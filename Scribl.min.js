(function(){var a=!1,c=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(b){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in b)f[g]=typeof b[g]=="function"&&typeof e[g]=="function"&&c.test(b[g])?function(a,c){return function(){var b=this._super;this._super=e[a];var d=c.apply(this,arguments);this._super=b;return d}}(g,b[g]):b[g];d.prototype=f;d.constructor=d;d.extend=arguments.callee;return d}})();var Scribl=Class.extend({init:function(a,c){var b=a.getContext("2d");this.width=c;this.trackSizes=50;this.trackBuffer=5;this.offset=void 0;this.canvas=a;this.ctx=b;this.scale={};this.scale.pretty=!0;this.scale.max=void 0;this.scale.min=void 0;this.scale.auto=!0;this.scale.off=!1;this.scale.size=15;this.scale.font={};this.scale.font.size=15;this.scale.font.color="black";this.scale.font.buffer=4;this.glyph={};this.glyph.roundness=6;this.glyph.linearGradient=["#99CCFF","rgb(63, 128, 205)"];this.glyph.text=
{};this.glyph.text.color="black";this.glyph.text.size="13";this.glyph.text.font="arial";this.glyph.text.align="center";this.gene={};this.gene.text={};this.protein={};this.protein.text={};this.events={};this.events.hasClick=!1;this.events.hasMouseover=!1;this.events.clicks=[];this.events.mouseovers=[];this.events.added=!1;this.tick={};this.tick.auto=!0;this.tick.major={};this.tick.major.size=10;this.tick.major.color="black";this.tick.minor={};this.tick.minor.size=1;this.tick.minor.color="rgb(55,55,55)";
this.tick.halfColor="rgb(10,10,10)";this.tooltips={};this.tooltips.text={};this.tooltips.text.font="arial";this.tooltips.text.size=12;this.tooltips.borderWidth=1;this.tooltips.roundness=5;this.tooltips.fade=!1;this.tooltips.style="light";this.myMouseEventHandler=new MouseEventHandler(this);this.tracks=[]},pixelsPerNt:function(a){return a==void 0?this.width/(this.scale.max-this.scale.min):a/(this.scale.max-this.scale.min)},ntsPerPixel:function(a){return a==void 0?1/this.pixelsPerNt():a/this.width},
getTrackSize:function(){return this.scale.size+this.scale.font.size},chartHeight:function(){var a=0;a+=this.getTrackSize();for(var c=0;c<this.tracks.length;c++)a+=this.trackBuffer,a+=this.tracks[c].getHeight();return a},addTrack:function(){var a=new track(this.ctx);a.chart=this;this.tracks.push(a);return a},loadGenbank:function(a){genbank(a,this)},loadBed:function(a){bed(a,this)},loadFeatures:function(a){for(var c=0;c<a.length;c++)this.addFeature(a[c])},addGene:function(a,c,b){return this.addFeature(new BlockArrow("gene",
a,c,b))},addProtein:function(a,c,b){return this.addFeature(new BlockArrow("protein",a,c,b))},addFeature:function(a){for(var c,b=!0,d=0;d<this.tracks.length;d++){var e=this.tracks[d].features[this.tracks[d].features.length-1];if(e!=void 0&&a.position-3/this.pixelsPerNt()>e.position+e.length){b=!1;c=this.tracks[d];break}}b&&(c=this.addTrack());c.addFeature(a);return a},slice:function(a,c){for(var b=[],d=0;d<this.tracks.length;d++)for(var e=this.tracks[d].features,f=0;f<e.length;f++){var g=e[f].position+
e[f].length,j=e[f].position;j>=a&&j<=c?b.push(e[f]):g>a&&g<c?b.push(e[f]):j<a&&g>c?b.push(e[f]):j>a&&g<c&&b.push(e[f])}d=new Scribl(this.canvas,this.width);d.loadFeatures(b);return d},delayed_draw:function(a){a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height);a.draw()},draw:function(){var a=this.ctx,c=this.tracks;a.save();if(this.scale.pretty){if(this.tick.auto)this.tick.major.size=this.determineMajorTick(),this.tick.minor.size=this.tick.major.size/10;if(this.scale.auto)this.scale.min-=this.scale.min%
this.tick.major.size,this.scale.max=Math.round(this.scale.max/this.tick.major.size+0.4)*this.tick.major.size}this.offset=this.scale.min.offset?a.measureText(this.getTickText(this.scale.min)).width/2+10:a.measureText("0").width/2+10;a.translate(this.offset,0);var b=this.scale.font.size+this.scale.size,d=this.scale.font.size+2,e=this.scale.font.size+this.scale.size*0.66,f=this.scale.font.size+this.scale.size*0.33;a.save();a.translate(-this.scale.min*this.pixelsPerNt(),0);a.font=this.scale.font.size+
"px arial";a.textBaseline="top";var g=a.fillStyle;a.fillStyle=this.scale.font.color;if(!this.scale.off)for(var j=this.scale.min;j<=this.scale.max;j++){var i=j*this.pixelsPerNt();a.beginPath();if(j%this.tick.major.size==0){var k=this.getTickText(j);a.textAlign="center";a.fillText(k,i,0);a.moveTo(i,b);a.lineTo(i,d);a.strokeStyle=this.tick.major.color;a.stroke()}else if(j%this.tick.minor.size==0)a.moveTo(i,b),j%(this.tick.major.size/2)==0?(a.strokeStyle=this.tick.halfColor,a.lineTo(i,f)):(a.strokeStyle=
this.tick.minor.color,a.lineTo(i,e)),a.stroke()}a.fillStyle=g;a.save();b=this.getTrackSize()+this.trackBuffer;a.translate(0,this.getTrackSize()+this.trackBuffer);for(j=0;j<c.length;j++)c[j].y=b,c[j].draw(),a.translate(0,c[j].getHeight()+this.trackBuffer),b=b+c[j].getHeight()+this.trackBuffer;a.restore();a.restore();a.restore();this.events.added||this.registerEventListeners()},redraw:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.tracks.length>0&&this.draw()},determineMajorTick:function(){this.ctx.font=
this.scale.font.size+"px arial";var a=this.width/(this.ctx.measureText(this.getTickText(this.scale.max)).width+this.scale.font.buffer);this.tick.major.size*=Math.round((this.scale.max-this.scale.min)/a/this.tick.major.size+0.4);digits=(this.tick.major.size+"").length;places=Math.pow(10,digits);first_digit=this.tick.major.size/places;first_digit>0.1&&first_digit<=0.5?first_digit=0.5:first_digit>0.5&&(first_digit=1);return first_digit*places},getTickText:function(a){if(!this.tick.auto)return a;var c=
a;a>=1E6?c=c/1E6+"m":a>=1E3&&(c=c/1E3+"k");return c},handleMouseEvent:function(a,c){this.myMouseEventHandler.setMousePosition(a);this.redraw();if(c=="click")var b=this.events.clicks,d=0;else b=this.events.mouseovers,d=0;for(;d<b.length;d++)b[d](this);this.myMouseEventHandler.reset(this)},addClickEventListener:function(a){this.events.clicks.push(a)},addMouseoverEventListener:function(a){this.events.mouseovers.push(a)},registerEventListeners:function(){var a=this;this.events.mouseovers.length>0&&this.canvas.addEventListener("mousemove",
function(c){a.handleMouseEvent(c,"mouseover")},!1);this.events.clicks.length>0&&this.canvas.addEventListener("click",function(c){a.handleMouseEvent(c,"click")},!1);this.events.added=!0}});var track=Class.extend({init:function(){this.height=void 0;this.features=[]},addGene:function(a,c,b){return this.addFeature(new BlockArrow("gene",a,c,b))},addProtein:function(a,c,b){return this.addFeature(new BlockArrow("protein",a,c,b))},addFeature:function(a){a.track=this;this.features.push(a);var c="this.chart."+a.type;if(!eval(c))eval(c+" = {}"),eval(c).text={};if(a.length+a.position>this.chart.scale.max||this.chart.scale.max==void 0)this.chart.scale.max=a.length+a.position;if(a.position<this.chart.scale.min||
this.chart.scale.min==void 0)this.chart.scale.min=a.position;return a},getHeight:function(){return this.height!=void 0?this.height:this.chart.trackSizes},draw:function(){for(var a=0;a<this.features.length;a++)this.features[a].draw()}});var MouseEventHandler=Class.extend({init:function(a){this.chart=a;this.mouseY=this.mouseX=null;this.eventElement=void 0;this.isEventDetected=!1;this.tooltip=new tooltips(this.chart)},addEvents:function(a){var c=this.chart,b=c.ctx,d=c.myMouseEventHandler;if(a.onMouseover&&!c.events.hasMouseover)c.addMouseoverEventListener(c.myMouseEventHandler.handleMouseover),c.events.hasMouseover=!0;else if(a.parent&&a.parent.onMouseover&&!c.events.hasMouseover)c.addMouseoverEventListener(c.myMouseEventHandler.handleMouseover),
c.events.hasMouseover=!0;if(a.onClick&&!c.events.hasClick)c.addClickEventListener(c.myMouseEventHandler.handleClick),c.addMouseoverEventListener(c.myMouseEventHandler.handleMouseStyle),c.events.hasClick=!0;else if(a.parent&&a.parent.onClick&&!c.events.hasClick)c.addClickEventListener(c.myMouseEventHandler.handleClick),c.addMouseoverEventListener(c.myMouseEventHandler.handleMouseStyle),c.events.hasClick=!0;if(!d.isEventDetected&&b.isPointInPath_mozilla(d.mouseX,d.mouseY))d.eventElement=a,d.isEventDetected=
!0},setMousePosition:function(a){if(a!=null){var c=this.chart.canvas.getBoundingClientRect();this.mouseX=a.clientX-c.left;this.mouseY=a.clientY-c.top}},handleClick:function(a){a=a.myMouseEventHandler.eventElement;a!=void 0&&a.onClick!=void 0?window.open(a.onClick):a&&a.parent&&a.parent.onClick&&window.open(a.parent.onClick)},handleMouseover:function(a){a=a.myMouseEventHandler;var c=a.eventElement;if(c!=void 0&&c.onMouseover!=void 0)a.tooltip.fire(c);else if(c&&c.parent&&c.parent.onMouseover)c.onMouseover=
c.parent.onMouseover,a.tooltip.fire(c)},handleMouseStyle:function(a){var c=a.myMouseEventHandler.eventElement;a.ctx.canvas.style.cursor=c&&c.onClick!=void 0?"pointer":c&&c.parent&&c.parent.onClick!=void 0?"pointer":"auto"},reset:function(a){a=a.myMouseEventHandler;a.mouseX=null;a.mouseY=null;a.eventElement=void 0;a.isEventDetected=null;a.elementIndexCounter=0}}),tooltips=Class.extend({init:function(a){this.chart=a;this.ctx=a.ctx},fire:function(a){var c=this.ctx.globalAlpha;this.chart.tooltips.fade?
h=1:this.draw(a,1);this.ctx.globalAlpha=c},draw:function(a,c){this.ctx.globalAlpha=c;var b=this.chart.tooltips.roundness,d=this.chart.tooltips.text.font,e=this.chart.tooltips.text.size;this.ctx.save();this.ctx.font=e+"px "+d;d=this.ctx.measureText(a.onMouseover);var f=[a.onMouseover],g=e+10,j=d.width+10,i=g-4,k,l;d=a.pixelPosition_x()+10;i=a.pixelPosition_y()-i;a.pixelLength();if(j>200)f=this.ctx.measureText("s").width,f=parseInt(200/f),f=ScriblWrapLines(f,a.onMouseover),j=210,g=f[1]*e+10,f=f[0];
j+d>this.chart.width&&(d=this.chart.width-j);if(this.chart.tooltips.style=="light")k=this.chart.ctx.createLinearGradient(d+j/2,i,d+j/2,i+g),k.addColorStop(0,"rgb(253, 248, 196)"),k.addColorStop(0.75,"rgb(253, 248, 196)"),k.addColorStop(1,"white"),l=this.chart.ctx.createLinearGradient(d+j/2,i,d+j/2,i+g),l.addColorStop(0,"black"),l.addColorStop(1,"rgb(64, 64, 64)"),this.chart.tooltips.text.color="black";else if(this.chart.tooltips.style=="dark")k=this.chart.ctx.createLinearGradient(d+j/2,i,d+j/2,i+
g),k.addColorStop(0,"rgb(64, 64, 64)"),k.addColorStop(1,"rgb(121, 121, 121)"),l="white",this.chart.tooltips.text.color="white";this.ctx.fillStyle=k;this.ctx.beginPath();tlc_ctrl_x=d;tlc_ctrl_y=i;tlc_lgth_x=d+b;tlc_lgth_y=i;tlc_wdth_x=d;tlc_wdth_y=i+b;blc_ctrl_x=d;blc_ctrl_y=i+g;blc_lgth_x=d+b;blc_lgth_y=i+g;blc_wdth_x=d;blc_wdth_y=i+g-b;brc_ctrl_x=d+j;brc_ctrl_y=i+g;brc_lgth_x=d+j-b;brc_lgth_y=i+g;brc_wdth_x=d+j;brc_wdth_y=i+g-b;trc_ctrl_x=d+j;trc_ctrl_y=i;trc_lgth_x=d+j-b;trc_lgth_y=i;trc_wdth_x=
d+j;trc_wdth_y=i+b;this.ctx.moveTo(tlc_lgth_x,tlc_lgth_y);this.ctx.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y);this.ctx.lineTo(blc_wdth_x,blc_wdth_y);this.ctx.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y);this.ctx.lineTo(brc_lgth_x,brc_lgth_y);this.ctx.quadraticCurveTo(brc_ctrl_x,brc_ctrl_y,brc_wdth_x,brc_wdth_y);this.ctx.lineTo(trc_wdth_x,trc_wdth_y);this.ctx.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y);this.ctx.lineTo(tlc_lgth_x,tlc_lgth_y);this.ctx.fill();
this.ctx.lineWidth=this.chart.tooltips.borderWidth;this.ctx.strokeStyle=l;this.ctx.stroke();this.ctx.textBaseline="middle";this.ctx.fillStyle=this.chart.tooltips.text.color;for(b=0;b<f.length;b++)this.ctx.measureText(f[b]),this.ctx.fillText(f[b],d+5,i+e*(b+1));this.ctx.restore()}});
CanvasRenderingContext2D.prototype.isPointInPath_mozilla=function(a,c){if(navigator.userAgent.indexOf("Firefox")!=-1){this.save();this.setTransform(1,0,0,1,0,0);var b=this.isPointInPath(a,c);this.restore()}else b=this.isPointInPath(a,c);return b};function ScriblWrapLines(a,c){for(var b=[],d="",e=0,f=(""+c).split(" "),g=0;g<f.length;g++)f[g].length+d.length<=a?d+=" "+f[g]:d==""?(trunc1=f[g].slice(0,a-1),d+=" "+trunc1+"-",trunc2=f[g].slice(a,f[g].length),f.splice(g+1,0,trunc2),b.push(d),d="",e++):(g--,b.push(d),e++,d="");e++;b.push(d);return[b,e]};var CanvasToSVG={idCounter:0,convert:function(a,c,b,d){var e=a.toDataURL(),f=document.createElementNS("http://www.w3.org/2000/svg","image");f.setAttribute("id","importedCanvas_"+this.idCounter++);f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e);f.setAttribute("x",b?b:0);f.setAttribute("y",d?d:0);f.setAttribute("width",a.width);f.setAttribute("height",a.height);f.imageData=a.toDataURL();c.appendChild(f)}},toXml=function(a){return $("<p/>").text(a).html()},svgToString=function(a){for(;removeUnusedDefElems()>
0;);pathActions.clear(!0);$.each(a.childNodes,function(c,b){c&&b.nodeType==8&&b.data.indexOf("Created with")>=0&&a.insertBefore(b,a.firstChild)});current_group&&(leaveContext(),selectOnly([current_group]));var c=[];$(a).find("g:data(gsvg)").each(function(){for(var a=this.attributes,b=a.length,f=0;f<b;f++)(a[f].nodeName=="id"||a[f].nodeName=="style")&&b--;if(b<=0)a=this.firstChild,c.push(a),$(this).replaceWith(a)});var b=svgToString(a,0);c.length&&$(c).each(function(){groupSvgElem(this)});return b};
svgToString=function(a,c){var b=[];if(a){var d=a.attributes,e,f,g=a.childNodes;for(f=0;f<c;f++)b.push(" ");b.push("<");b.push(a.nodeName);if(a.id=="svgcontent"){f=getResolution();b.push(' width="'+f.w+'" height="'+f.h+'" xmlns="'+svgns+'"');var j={};$(a).find("*").andSelf().each(function(){$.each(this.attributes,function(a,c){var d=c.namespaceURI;d&&!j[d]&&nsMap[d]!=="xmlns"&&nsMap[d]!=="xml"&&(j[d]=!0,b.push(" xmlns:"+nsMap[d]+'="'+d+'"'))})});for(f=d.length;f--;){e=d.item(f);var i=toXml(e.nodeValue);
if(e.nodeName.indexOf("xmlns:")!==0&&i!=""&&["width","height","xmlns","x","y","viewBox","id","overflow"].indexOf(e.localName)==-1&&(!e.namespaceURI||nsMap[e.namespaceURI]))b.push(" "),b.push(e.nodeName),b.push('="'),b.push(i),b.push('"')}}else for(f=d.length-1;f>=0;f--)e=d.item(f),i=toXml(e.nodeValue),!(["-moz-math-font-style","_moz-math-font-style"].indexOf(e.localName)>=0)&&i!=""&&i.indexOf("pointer-events")!==0&&!(e.localName==="class"&&i.indexOf("se_")===0)&&(b.push(" "),e.localName==="d"&&(i=
pathActions.convertPath(a,!0)),b.push(e.nodeName),b.push('="'),b.push(i),b.push('"'));if(a.hasChildNodes()){b.push(">");c++;d=!1;for(f=0;f<g.length;f++)switch(e=g.item(f),e.nodeType){case 1:b.push("\n");b.push(svgToString(g.item(f),c));break;case 3:e=e.nodeValue.replace(/^\s+|\s+$/g,"");e!=""&&(d=!0,b.push(toXml(e)+""));break;case 8:b.push("\n"),b.push(Array(c+1).join(" ")),b.push("<\!--"),b.push(e.data),b.push("--\>")}c--;if(!d){b.push("\n");for(f=0;f<c;f++)b.push(" ")}b.push("</");b.push(a.nodeName);
b.push(">")}else b.push("/>")}return b.join("")};var Glyph=Class.extend({init:function(a,c,b,d,e){this.position=c;this.length=b;this.strand=d;this.type=a;this.name="";this.borderColor="none";this.font={};this.font.style=void 0;this.font.size=void 0;this.font.color=void 0;this.font.align=void 0;for(var f in e)typeof e[f]=="string"&&(e[f]="'"+e[f]+"'"),eval("glyph."+f+"="+e[f])},pixelLength:function(){return this.length*this.track.chart.pixelsPerNt()||1},pixelPosition_x:function(){return this.position*this.track.chart.pixelsPerNt()},pixelPosition_y:function(){return this.track.y},
setTextOptions:function(){var a="this.track.chart."+this.type;if(this.font.style!=void 0)this.font.style=this.font.style;else if(this.parent&&this.parent.font.color!=void 0)this.font.style=this.parent.font.color;else if(eval(a).text.font!=void 0)this.font.style=eval(a).text.font;else if(this.track.chart.glyph.text.font!=void 0)this.font.style=this.track.chart.glyph.text.font;if(this.font.size!=void 0)this.font.size=this.font.size;else if(this.parent&&this.parent.font.size!=void 0)this.font.size=this.parent.font.size;
else if(eval(a).text.size!=void 0)this.font.size=eval(a).text.size;else if(this.track.chart.glyph.text.size!=void 0)this.font.size=this.track.chart.glyph.text.size;if(this.font.color!=void 0)this.font.color=this.font.color;else if(this.parent&&this.parent.font.color!=void 0)this.font.color=this.parent.font.color;else if(eval(a).text.color!=void 0)this.font.color=eval(a).text.color;else if(this.track.chart.glyph.text.color!=void 0)this.font.color=this.track.chart.glyph.text.color;if(this.font.align!=
void 0)this.font.align=this.font.align;else if(this.parent&&this.parent.font.align!=void 0)this.font.align=this.parent.font.align;else if(eval(a).text.align!=void 0)this.font.align=eval(a).text.align;else if(this.track.chart.glyph.text.align!=void 0)this.font.align=this.track.chart.glyph.text.align},drawText:function(a){var c=this.track.chart.ctx,b=this.pixelLength(),d=this.getHeight(),e=this.font.size,f=this.font.style;c.font=e+"px "+f;c.textBaseline="middle";c.fillStyle=this.font.color;var g=void 0;
if(this.font.align=="start")this.font.align=this.strand=="+"?"left":"right";else if(this.font.align=="end")this.font.align=this.strand=="+"?"right":"left";c.textAlign=this.font.align;c.textAlign=="left"?g=5:c.textAlign=="center"?g=b/2:c.textAlign=="right"&&(g=b-5);var j=c.measureText(a);if(a!=""){for(;b-j.width<4;)if(e=/^\d+/.exec(c.font),e--,j=c.measureText(a),c.font=e+"px "+f,e<=8){a="";break}this.glyphType=="Complex"&&(b=0,e=/^\d+/.exec(c.font),this.font.align=="center"&&(b=-(c.measureText(a).width/
2+2.5)),c.clearRect(g+b,d/2-e/2,c.measureText(a).width+5,e));c.fillText(a,g,d/2)}},getRoundness:function(){var a;a="this.track.chart."+this.type;a=this.roundness!=void 0?this.roundness:this.parent&&this.parent.roundness!=void 0?this.parent.roundness:eval(a)!=void 0&&eval(a).roundness!=void 0?eval(a).roundness:this.track.chart.glyph.roundness;return this.getHeight()*a/100},getHeight:function(){return this.track.getHeight()},getStrokeStyle:function(){var a;a="this.track.chart."+this.type;if(this.borderColor!=
void 0)a=this.borderColor;else if(this.parent&&this.parent.color!=void 0)a=this.parent.color;else if(eval(a).color!=void 0)a=eval(a).color;else if(eval(a).linearGradient!=void 0){for(var c=this.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),b=0;b<eval(a).linearGradient.length;b++){var d=b/(eval(a).linearGradient.length-1);c.addColorStop(d,eval(a).linearGradient[b])}a=c}else a=this.track.chart.glyph.borderColor!=void 0?this.track.chart.glyph.borderColor:black;return a},getFillStyle:function(){var a;
a="this.track.chart."+this.type;if(this.color!=void 0)a=this.color;else if(this.parent&&this.parent.color!=void 0)a=this.parent.color;else if(eval(a).color!=void 0)a=eval(a).color;else if(eval(a).linearGradient!=void 0){for(var c=this.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight()),b=0;b<eval(a).linearGradient.length;b++){var d=b/(eval(a).linearGradient.length-1);c.addColorStop(d,eval(a).linearGradient[b])}a=c}else if(this.track.chart.glyph.color!=void 0)a=this.track.chart.glyph.color;
else{c=this.ctx.createLinearGradient(this.length/2,0,this.length/2,this.getHeight());for(b=0;b<this.track.chart.glyph.linearGradient.length;b++)d=b/(this.track.chart.glyph.linearGradient.length-1),c.addColorStop(d,this.track.chart.glyph.linearGradient[b]);a=c}return a},isSubFeature:function(){return this.parent!=void 0},clearInside:function(){this.ctx.clearRect(0,0,this.pixelLength(),this.getHeight())},draw:function(){this.setTextOptions();this.ctx=this.track.chart.ctx;this.ctx.beginPath();/^\d+/.exec(this.ctx.font);
var a=/\S+$/.exec(this.ctx.font);this.ctx.fillStyle=this.getFillStyle();var c=this.ctx.fillStyle,b=this.pixelPosition_x(),d=this.getHeight();d<10?this.ctx.font="10px "+a:this.ctx.font=d*0.9+"px "+a;this.ctx.translate(b,0);this.strand=="-"&&!this.isSubFeature()&&this.ctx.transform(-1,0,0,1,this.pixelLength(),0);this._draw();if(this.borderColor!="none")this.color=="none"&&this.parent.glyphType=="Spliced"&&this.clearInside(),a=this.ctx.strokeStyle,this.ctx.strokeStyle=this.getStrokeStyle(),this.ctx.stroke(),
this.ctx.strokeStyle=a;this.color!="none"&&this.ctx.fill();this.strand=="-"&&!this.isSubFeature()&&this.ctx.transform(-1,0,0,1,this.pixelLength(),0);this.drawText(this.name);this.ctx.translate(-b,0);this.ctx.fillStyle=c;this.track.chart.myMouseEventHandler.addEvents(this)}});var BlockArrow=Glyph.extend({init:function(a,c,b,d,e){this._super(a,c,b,d,e);this.slope=1;this.name="";this.glyphType="BlockArrow"},_draw:function(a,c,b,d){a=a||this.ctx;c=c||this.pixelLength();b=b||this.getHeight();d=d+1||this.getRoundness();d!=void 0&&(d-=1);tc_ctrl_y=tc_ctrl_x=x=y=0;tc_lgth_x=x+d;tc_lgth_y=y;tc_wdth_x=x;tc_wdth_y=y+d;bc_ctrl_x=x;bc_ctrl_y=y+b;bc_lgth_x=x+d;bc_lgth_y=y+b;bc_wdth_x=x;bc_wdth_y=y+b-d;a_b_x=x+c-d;a_t_x=x+c-d;a_max_x=x+c;t=0.5;a_ctrl_x=(a_max_x-(1-t)*(1-t)*a_b_x-t*
t*a_t_x)/(2*(1-t)*t);a_ctrl_y=y+b/2;bs_slope=this.slope;bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x;ts_slope=-this.slope;ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x;a_b_y=-(bs_slope*a_b_x+bs_intercept);a_t_y=-(ts_slope*a_t_x+ts_intercept);bs_ctrl_y=y+b;bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/this.slope;bs_ctrl_x<x?(new Rect(this.type,0,c))._draw(a,c,b,d):(bs_lgth_y=y+b,bs_lgth_x=bs_ctrl_x-d,bs_slpe_x=bs_ctrl_x+d,bs_slpe_y=-(bs_slope*bs_slpe_x+bs_intercept),ts_ctrl_y=y,ts_ctrl_x=(ts_ctrl_y+ts_intercept)/this.slope,
ts_lgth_y=y,ts_lgth_x=ts_ctrl_x-d,ts_slpe_x=ts_ctrl_x+d,ts_slpe_y=-(ts_slope*ts_slpe_x+ts_intercept),a.beginPath(),a.moveTo(tc_lgth_x,tc_lgth_y),a.quadraticCurveTo(tc_ctrl_x,tc_ctrl_y,tc_wdth_x,tc_wdth_y),a.lineTo(bc_wdth_x,bc_wdth_y),a.quadraticCurveTo(bc_ctrl_x,bc_ctrl_y,bc_lgth_x,bc_lgth_y),a.lineTo(bs_lgth_x,bs_lgth_y),a.quadraticCurveTo(bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y),a.lineTo(a_b_x,a_b_y),a.quadraticCurveTo(a_ctrl_x,a_ctrl_y,a_t_x,a_t_y),a.lineTo(ts_slpe_x,ts_slpe_y),a.quadraticCurveTo(ts_ctrl_x,
ts_ctrl_y,ts_lgth_x,ts_lgth_y),a.lineTo(tc_lgth_x,tc_lgth_y))}});var Rect=Glyph.extend({init:function(a,c,b,d){this._super(a,c,b,"+",d);this.glyphType="Rect"},_draw:function(a,c,b,d){a=a||this.ctx;c=c||this.pixelLength();b=b||this.getHeight();d=d+1||this.getRoundness();d!=void 0&&(d-=1);x=y=0;a.beginPath();tlc_ctrl_x=x;tlc_ctrl_y=y;tlc_lgth_x=x+d;tlc_lgth_y=y;tlc_wdth_x=x;tlc_wdth_y=y+d;blc_ctrl_x=x;blc_ctrl_y=y+b;blc_lgth_x=x+d;blc_lgth_y=y+b;blc_wdth_x=x;blc_wdth_y=y+b-d;brc_ctrl_x=x+c;brc_ctrl_y=y+b;brc_lgth_x=x+c-d;brc_lgth_y=y+b;brc_wdth_x=x+c;brc_wdth_y=
y+b-d;trc_ctrl_x=x+c;trc_ctrl_y=y;trc_lgth_x=x+c-d;trc_lgth_y=y;trc_wdth_x=x+c;trc_wdth_y=y+d;a.moveTo(tlc_lgth_x,tlc_lgth_y);a.quadraticCurveTo(tlc_ctrl_x,tlc_ctrl_y,tlc_wdth_x,tlc_wdth_y);a.lineTo(blc_wdth_x,blc_wdth_y);a.quadraticCurveTo(blc_ctrl_x,blc_ctrl_y,blc_lgth_x,blc_lgth_y);a.lineTo(brc_lgth_x,brc_lgth_y);a.quadraticCurveTo(brc_ctrl_x,brc_ctrl_y,brc_wdth_x,brc_wdth_y);a.lineTo(trc_wdth_x,trc_wdth_y);a.quadraticCurveTo(trc_ctrl_x,trc_ctrl_y,trc_lgth_x,trc_lgth_y);a.lineTo(tlc_lgth_x,tlc_lgth_y)}});var Line=Glyph.extend({init:function(a,c,b,d){this.thickness=2;this._super(a,c,b,"+",d);this.glyphType="Line"},_draw:function(a,c,b){a=a||this.ctx;c=c||this.pixelLength();b=b||this.getHeight();x=y=0;a.beginPath();a.moveTo(x,b/2-this.thickness/2);a.lineTo(x,b/2+this.thickness/2);a.lineTo(x+c,b/2+this.thickness/2);a.lineTo(x+c,b/2-this.thickness/2)}});var Complex=Glyph.extend({init:function(a,c,b,d,e,f){this._super(a,c,b,d,f);this.slope=1;this.glyphType="Complex";this.subFeatures=e;this.line=new Line(a,0,b);this.line.parent=this;this.line.color="black";this.line.thickness=2},addSubFeature:function(a){this.subFeatures.push(a)},_draw:function(a,c,b,d){a=a||this.ctx;c||this.pixelLength();b||this.getHeight();d+1||this.getRoundness();x=y=0;this.line.track=this.track;this.line.draw();c=this.subFeatures.length;for(b=0;b<c;b++)this.subFeatures[b].parent=
this,this.subFeatures[b].track=this.track,this.subFeatures[b].draw();a.beginPath()}});var Arrow=Glyph.extend({init:function(a,c,b,d){this._super(a,c,0,b,d);this.slope=1;this.name="";this.glyphType="Arrow";this.thickness=4.6},pixelThickness:function(){return this.thickness/10*(this.getHeight()/2/Math.tan(Math.atan(this.slope)))},clearInside:function(){var a=this.pixelThickness();this.ctx.clearRect(-a,0,a,this.getHeight())},_draw:function(a,c,b,d){a=a||this.ctx;b=b||this.getHeight();d=d+1||this.getRoundness();d!=void 0&&(d-=1);c=this.pixelThickness();x=y=0;a_b_x=x-0-d;a_t_x=x-0-d;a_max_x=
x-0;t=0.5;a_ctrl_x=(a_max_x-(1-t)*(1-t)*a_b_x-t*t*a_t_x)/(2*(1-t)*t);a_ctrl_y=y+b/2;bs_slope=this.slope;bs_intercept=-a_ctrl_y-bs_slope*a_ctrl_x;ts_slope=-this.slope;ts_intercept=-a_ctrl_y-ts_slope*a_ctrl_x;a_b_y=-(bs_slope*a_b_x+bs_intercept);a_t_y=-(ts_slope*a_t_x+ts_intercept);a.beginPath();bs_ctrl_y=y+b;bs_ctrl_x=(-bs_ctrl_y-bs_intercept)/this.slope;bs_slpe_x=bs_ctrl_x+d+d;bs_slpe_y=-(bs_slope*bs_slpe_x+bs_intercept);a.moveTo(bs_slpe_x,bs_slpe_y);a.lineTo(a_b_x,a_b_y);a.quadraticCurveTo(a_ctrl_x,
a_ctrl_y,a_t_x,a_t_y);ts_ctrl_y=y;ts_ctrl_x=(ts_ctrl_y+ts_intercept)/this.slope;ts_slpe_x=ts_ctrl_x+d+d;ts_slpe_y=-(ts_slope*ts_slpe_x+ts_intercept);a.lineTo(ts_slpe_x,ts_slpe_y);var e=Math.PI-Math.abs(Math.atan(this.slope))-Math.PI/2;d=Math.sin(e)*c;e=Math.cos(e)*c;a.bezierCurveTo(ts_ctrl_x,ts_ctrl_y,ts_ctrl_x-d,ts_ctrl_y+e,ts_slpe_x-d,ts_slpe_y+e);a.lineTo(a_max_x-c,y+b/2);a.lineTo(bs_slpe_x-d,bs_slpe_y-e);a.bezierCurveTo(bs_ctrl_x-d,bs_ctrl_y-e,bs_ctrl_x,bs_ctrl_y,bs_slpe_x,bs_slpe_y)}});function genbank(a,c){for(var b=a.split("\n"),d=RegExp(/\s+gene\s+([a-z]*)\(?(\d+)\.\.(\d+)/),e=[],f=void 0,g=void 0,j=0;j<b.length;j++){var i;if(i=b[j].match(d)){i.shift();e.push(i);var k=i[2];if(f==void 0||f>k)f=k;i=i[1];if(g==void 0||g<i)g=i}}c.scale.max=f;c.scale.min=g;for(b=0;b<e.length;b++)d="+",e[b][0]=="complement"&&(d="-"),i=e[b][1],k=e[b][2],i=i-1+1,c.addGene(i,k-i,d)};function bed(a,c){var b=a.split("\n");numFeatures=b.length;for(var d=1;d<numFeatures;d++){if(b[d]=="")break;var e=b[d].split(" "),f=parseInt(e[1]),g=parseInt(e[2]),j=e[0]+": "+e[3],i=e[5],k=e[8],l=e[10].split(",");e=e[11].split(",");f=c.addFeature(new Complex("complex",f,g,i,[],{color:k,name:j}));for(g=0;g<l.length;g++){if(l[g]=="")break;f.addSubFeature(new BlockArrow("complex",parseInt(e[g]),parseInt(l[g]),i))}}};
